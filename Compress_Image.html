<html>
  <head></head>
  <body>
    <input type="file" multiple accept="image/*" />
    <div></div>
  </body>
  <script>
    d = document.querySelector('div');
    function processFile(file) {
      new Promise(function (resolve) {
        let raw = new Image();
        raw.addEventListener('load', function () {
          resolve(raw);
        });
        raw.src = URL.createObjectURL(file);
      }).then(function (raw) {
        canvas = document.createElement('canvas');
        tooBig = raw.width > 300;
        nWidth = tooBig ? 300 : raw.width;
        nHeight = tooBig ? (raw.height * 300) / raw.width : raw.height;
        canvas.width = nWidth;
        canvas.height = nHeight;
        canvas.getContext('2d').drawImage(raw, 0, 0, nWidth, nHeight);
        aa = canvas.toDataURL('image/webp', 0.1);
        d.innerHTML += `<img src=${aa}>`;
      });
    }
    document.querySelector('input').addEventListener('change', function () {
      d.innerHTML = '';
      for (let file of this.files) processFile(file);
    });
  </script>
</html>
